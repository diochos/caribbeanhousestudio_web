<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="stylesheet" href="./global.css" />
    <link rel="stylesheet" href="./catalogo.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@400;600;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,300;0,400;0,500;0,600&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Literata:wght@400&display=swap"
    />
  </head>
  <body>
    <div class="canvas">
      <!-- Barra de navegación fija -->
      <header class="barra-pestaas5">
        
        <div class="component-1-13">
          
          <div class="component-1-13-child">
            <div class="menu-button" onclick="toggleMenu()">
              <svg xmlns="http://www.w3.org/2000/svg" height="26" viewBox="0 96 960 960" width="26">
                <path d="M120 816v-60h720v60H120Zm0-210v-60h720v60H120Zm0-210v-60h720v60H120Z"/>
              </svg>
            </div>
          </div>
          
          <div class="logo5" id="logo">
            <div class="caribbean-house-studio11">Caribbean House Studio</div>
          </div>
          <img class="logo-icon5" alt="" src="./public/logo.svg" />
          
        </div>
        
        <div class="menu-items">
          <div class="inicio5" id="in">INICIO</div>
          <div class="catlogo5">CATÁLOGO</div>
          <div class="blog5">BLOG</div>
          <div class="nuestra-historia6" id="nh">NUESTRA HISTORIA</div>
          <div class="seguimiento7" id="seg">SEGUIMIENTO</div>
          <img class="serach-icon5" alt="" src="./public/serach.svg" />
          <img class="cart-icon5" alt="" src="./public/cart.svg" />
          <div class="login-wrapper3">
            <div class="login5">Login</div>
          </div>
          <img class="path-74-icon5" alt="" src="./public/path-74.svg" />
          <div class="div26">1</div>
          
        </div>

        <div class="menu-container">
          <ul class="sidebar-burger">
            <li onclick="hideSidebar()">
              <a href="#">
                <svg xmlns="http://www.w3.org/2000/svg" height="26" viewBox="0 96 960 960" width="26">
                  <path d="m249 849-42-42 231-231-231-231 42-42 231 231 231-231 42 42-231 231 231 231-42 42-231-231-231 231Z"/>
                </svg>
              </a>
            </li>
            <li><a href="./"  id="in">INICIO</a></li>
            <li><a href="#">CATÁLOGO</a></li>
            <li><a href="#">BLOG</a></li>
            <li><a href="./about-us.html">NUESTRA HISTORIA</a></li>
            <li><a href="#">SEGUIMIENTO</a></li>
            <li><a href="#">Login</a></li>
          </ul>
        </div>

        
        
      </header>

      <!-- Contenedor para el catálogo -->
      <div class="catalog-container">

        
        <!-- Barra lateral de filtros -->
        <aside class="sidebar">
          <!-- Barra de búsqueda -->
          <div class="search-bar">
            <form action="/catalogo" method="GET">
              <input 
                type="text" 
                name="query" 
                placeholder="Buscar productos" 
                value="<%= typeof searchQuery !== 'undefined' ? searchQuery : '' %>" 
                class="search-input"
              />
              <!-- Mantener la categoría seleccionada cuando se realiza una búsqueda -->
              <input type="hidden" name="categoria" value="<%= typeof categoriaSeleccionada !== 'undefined' ? categoriaSeleccionada : '' %>">
              <button type="submit" class="search-button">Buscar</button>
            </form>
          </div>
          
          <h3>Categorías</h3>
          <ul>   
            <!-- Listar dinámicamente las categorías -->
            <% categorias.forEach(function(categoria) { %>
              <li class="<%= categoria.categoria === categoriaSeleccionada ? 'active' : '' %>">
                <a 
                  href="/catalogo?categoria=<%= categoria.categoria %>" 
                  class="<%= categoria.categoria === categoriaSeleccionada ? 'active' : '' %>"
                >
                  <%= categoria.categoria %> (<%= categoria.cantidad %>)
                </a>
              </li>
            <% }); %>
          </ul>
        </aside>
        
        
  
        <section class="product-grid">
          <!-- Lista dinámica de productos -->
          <div class="product-list">
            <% productos.forEach(function(producto) { %>
              <!-- Comprobamos si el stock es 0 para usar no-stock en lugar de product-card -->
              <% if (producto.stock > 0) { %>
                <a href="/producto?id=<%= producto.producto_id %>" class="product-link">
                  <div class="product-card">
                    <img src="<%= producto.imagePath %>" alt="<%= producto.nombre %>" class="product-image">
                    <div class="product-details">
                      <h3 class="product-title"><%= producto.nombre %></h3>
                      <p class="product-sku">SKU <%= producto.codigo %></p>
                      <div class="product-price">
                        <p class="discounted-price">$<%= producto.precio %></p>
                      </div>
                    </div>
                  </div>
                </a>
              <% } else { %>
                <a href="/producto?id=<%= producto.producto_id %>" class="product-link">
                  <div class="no-stock">
                    <img src="<%= producto.imagePath %>" alt="<%= producto.nombre %>" class="product-image">
                    <div class="product-details">
                      <h3 class="product-title"><%= producto.nombre %></h3>
                      <p class="product-sku">SKU <%= producto.codigo %></p>
                      <div class="product-price">
                        <p class="discounted-price">$<%= producto.precio %></p>
                      </div>
                      <div class="no-stock-overlay">No disponible por el momento</div>
                    </div>
                  </div>
                </a>
              <% } %>
            <% }); %>
          </div>
          
        
          <!-- Paginación 4-->
          <div class="pagination">
            <% if (paginaActual > 1) { %>
              <a href="/catalogo?page=<%= paginaActual - 1 %>" class="page-button">Anterior</a>
            <% } %>
        
            <% for (let i = 1; i <= totalPaginas; i++) { %>
              <a href="/catalogo?page=<%= i %>" class="page-button <%= i === paginaActual ? 'active' : '' %>"><%= i %></a>
            <% } %>
        
            <% if (paginaActual < totalPaginas) { %>
              <a href="/catalogo?page=<%= paginaActual + 1 %>" class="page-button">Siguiente</a>
            <% } %>
          </div>
        </section>
        
    
                

        <img
        class="fondo"
        alt=""
        />
      </div>
     
    </div>
    
    <!-- Footer -->
    <div id="footer"></div>

    <script>
      // Carga el archivo footer.html dinámicamente
      window.onload = function () {
        fetch("/Templates/footer.html")
          .then((response) => response.text())
          .then((data) => {
            document.getElementById("footer").innerHTML = data;
          });
      };

      // Navegación
      var nUESTRAHISTORIAText = document.getElementById("nh");
      if (nUESTRAHISTORIAText) {
        nUESTRAHISTORIAText.addEventListener("click", function (e) {
          window.location.href = "./about-us.html";
        });
      }

      var inicio = document.getElementById("in");
      if (inicio) {
        inicio.addEventListener("click", function (e) {
          window.location.href = "./";
        });
      }

      var sEGUIMIENTOText = document.getElementById("seg");
      if (sEGUIMIENTOText) {
        sEGUIMIENTOText.addEventListener("click", function (e) {
          window.location.href = "./añadirID.html";
        });
      }

      var logo = document.getElementById("logo");
      if (logo) {
        logo.addEventListener("click", function (e) {
          window.location.href = "/";
        });
      }
        function toggleMenu() {
        const menu = document.querySelector('.menu-container');
      menu.classList.toggle('active'); // Activa o desactiva el menú
      }

      function hideSidebar() {
      const menu = document.querySelector('.menu-container');
      menu.classList.remove('active'); // Oculta el menú
      }
      
    </script>
  </body>
</html>
